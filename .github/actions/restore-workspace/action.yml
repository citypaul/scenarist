name: 'Restore Workspace'
description: 'Setup Node/pnpm and restore build cache (requires checkout first)'

runs:
  using: 'composite'
  steps:
    - name: Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 9.0.0

    - name: Setup Node.js environment
      uses: actions/setup-node@v4
      with:
        node-version-file: ".nvmrc"
        cache: "pnpm"

    - name: Restore build artifacts
      uses: actions/cache/restore@v4
      with:
        path: |
          .turbo
          node_modules
          packages/*/dist
          packages/*/node_modules
          internal/*/dist
          internal/*/node_modules
          apps/*/node_modules
          apps/*/.next
          apps/docs/dist
          ~/.cache/ms-playwright
          pnpm-lock.yaml
        key: build-${{ github.sha }}
        fail-on-cache-miss: true
