name: 'Restore Workspace'
description: 'Setup Node/pnpm and restore build cache (requires checkout first)'

runs:
  using: 'composite'
  steps:
    - name: Setup pnpm
      uses: pnpm/action-setup@9fd676a19091d4595eefd76e4bd31c97133911f1 # v4.2.0
      with:
        version: 9.0.0

    - name: Setup Node.js environment
      uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
      with:
        node-version-file: ".nvmrc"
        cache: "pnpm"

    - name: Restore build artifacts
      uses: actions/cache/restore@0057852bfaa89a56745cba8c7296529d2fc39830 # v4.3.0
      with:
        path: |
          .turbo
          node_modules
          packages/*/dist
          packages/*/node_modules
          internal/*/dist
          internal/*/node_modules
          apps/*/node_modules
          apps/*/.next
          apps/docs/dist
          ~/.cache/ms-playwright
          pnpm-lock.yaml
        key: build-${{ github.sha }}
        fail-on-cache-miss: true
